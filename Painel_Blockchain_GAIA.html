<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel_Blockchain_GAIA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg-0: #000;
      --bg-1: #0e1313;
      --bg-2: #111b1a;
      --ink: #eaf8f3;
      --brand: #74f2ce;
      --brand-2: #2de0c1;
      --soft: rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      background: radial-gradient(1000px 700px at 70% -10%, rgba(45,224,193,0.08), transparent 40%),
                  radial-gradient(1000px 700px at 10% 10%, rgba(116,242,206,0.06), transparent 40%),
                  linear-gradient(180deg, #0a0f0f 0%, #000 40%, #000 100%);
      font-family: "Segoe UI", system-ui, -apple-system, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      line-height:1.55;
      padding:28px 18px 60px;
    }
    .topbar{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
      max-width:1100px; margin:0 auto 10px;
    }
    .topbar a{
      text-decoration:none; color:var(--brand);
      border:1px solid rgba(116,242,206,0.6);
      padding:8px 14px; border-radius:999px; font-weight:600; font-size:.95rem;
      background: rgba(0,0,0,.35);
      transition:.25s ease;
    }
    .topbar a:hover{ box-shadow:0 0 12px rgba(116,242,206,.45); background:rgba(116,242,206,.10); }
    header{ max-width:1100px; margin:8px auto 22px; text-align:center;}
    h1{
      margin:.2rem 0 0.6rem; font-size:clamp(1.8rem, 3.6vw, 2.6rem);
      text-shadow:0 0 15px var(--brand), 0 0 28px var(--brand-2);
      filter: drop-shadow(0 0 5px var(--brand-2));
    }
    .subtitle{
      color:#cfeee6; max-width:900px; margin:0 auto;
      font-size:1.02rem;
    }
    .wrap{ max-width:1100px; margin:22px auto; }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
      border:1px solid rgba(116,242,206,0.10);
      border-radius:14px; padding:16px 16px 6px; box-shadow:0 10px 28px rgba(0,0,0,.55);
    }
    .panel h2{
      margin:6px 8px 12px; font-size:1.2rem; color:var(--brand);
      letter-spacing:.2px;
    }
    .grid{
      display:grid; grid-template-columns: 1.15fr .85fr; gap:18px;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }

    .graph-wrap{ padding:12px; border-radius:12px; background: rgba(255,255,255,0.02); border:1px solid rgba(116,242,206,0.07); }
    #networkBlockchainFull{ width:100%; height:520px; border-radius:10px; background:transparent; }

    .legend{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; padding:10px 8px 2px; font-size:.95rem; color:#cfeee6;
    }
    .pill{ display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,0.04); border:1px dashed rgba(116,242,206,0.35); }
    .dot{ width:12px; height:12px; border-radius:999px; display:inline-block; }
    .v{ background:#1f7a5a; border:1px solid #74f2ce; }        /* Validado */
    .p{ background:#945d14; border:1px solid #ffd28f; }        /* Pendente */
    .r{ background:#7a1f2e; border:1px solid #ffb3c9; }        /* Rejeitado */
    .m{ background:#2b3a3f; border:1px solid #9fbdb6; }        /* Minerador */
    .mp{ background:#063a6b; border:1px solid #74f2ce; }       /* Mempool */

    .aside{
      background: rgba(255,255,255,0.02);
      border:1px solid rgba(116,242,206,0.08);
      border-radius:12px; padding:12px 14px;
      height:100%;
    }
    .aside h3{ margin:6px 4px 10px; color:var(--brand); font-size:1.05rem;}
    .aside p, .aside li{ color:#e7f9f2; }
    .aside ul{ margin:6px 0 0 18px; }

    .instructions{
      margin:10px 0 12px; font-size:.95rem; color:#cfeee6;
      background: rgba(255,255,255,0.03);
      border:1px dashed rgba(116,242,206,0.35);
      border-radius:8px; padding:10px 12px;
    }

    #details{
      display:none; margin-top:12px; background:rgba(255,255,255,0.03);
      border-left:3px solid var(--brand);
      color:#e7f9f2; padding:14px; border-radius:8px;
    }
    #details h4{ margin:0 0 6px; color:var(--brand); }
    .close-btn{
      margin-top:8px; background:transparent; color:var(--brand);
      border:1px solid rgba(116,242,206,0.25); padding:6px 10px; border-radius:8px; cursor:pointer;
    }

    footer{
      max-width:1100px; margin:28px auto 0; color:#cfeee6; font-size:.95rem; text-align:center;
      opacity:.9;
    }
  </style>

  <!-- vis-network -->
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>

  <nav class="topbar">
    <a href="infraestrutura_digital.html"
       onclick="event.preventDefault(); if(document.referrer){history.back()} else {window.location.href='infraestrutura_digital.html'}">
      ‚Üê Voltar
    </a>
  </nav>

  <header>
    <h1>Blockchain ‚Äì BIOCERR</h1>
    <p class="subtitle">
      Registro distribu√≠do, imut√°vel e audit√°vel para rastrear opera√ß√µes da Ind√∫stria Matriz e das MCEFPs,
      garantindo confian√ßa, transpar√™ncia e governan√ßa no <strong>SMPD</strong>.
    </p>
  </header>

  <main class="wrap">
    <section class="panel">
      <h2>Vis√£o Interativa da Cadeia de Blocos</h2>
      <div class="grid">
        <div>
          <div class="graph-wrap">
            <div id="networkBlockchainFull" aria-label="Cadeia de blocos BIOBlock ‚Äì gr√°fico interativo" role="img"></div>
            <div class="legend" aria-hidden="true">
              <span class="pill"><span class="dot v"></span> Bloco validado</span>
              <span class="pill"><span class="dot p"></span> Bloco pendente</span>
              <span class="pill"><span class="dot r"></span> Bloco rejeitado</span>
              <span class="pill"><span class="dot m"></span> Minerador/Validador</span>
              <span class="pill"><span class="dot mp"></span> Mempool (transa√ß√µes)</span>
            </div>
            <div class="instructions">
              üí° <strong>Como interagir:</strong> role para dar zoom ‚Ä¢ arraste para mover ‚Ä¢ clique em um n√≥ para ver detalhes ‚Ä¢
              <em>duplo clique</em> para recentralizar o enquadramento.
            </div>
            <div id="details" role="region" aria-live="polite"></div>
          </div>
        </div>

        <aside class="aside">
          <h3>O que voc√™ est√° vendo</h3>
          <p>
            Um modelo did√°tico do <strong>BIOBlock</strong>: blocos encadeados por
            <em>hash</em> anterior, <em>mempool</em> com transa√ß√µes pendentes,
            mineradores/validadores e um exemplo de <em>fork</em> curto resolvido por
            maior peso (cadeia mais longa).
          </p>
          <ul>
            <li><strong>Integridade:</strong> qualquer altera√ß√£o quebra o hash e √© rejeitada.</li>
            <li><strong>Transpar√™ncia:</strong> auditoria em tempo real dos lotes.</li>
            <li><strong>Automa√ß√£o:</strong> <em>smart contracts</em> para regras entre Matriz e MCEFPs.</li>
            <li><strong>Rastreabilidade:</strong> do IBC produzido at√© o envase local e log√≠stica.</li>
          </ul>

          <h3 style="margin-top:14px">Aplica√ß√µes no SMPD</h3>
          <ul>
            <li>Registro de produ√ß√£o na <em>Ind√∫stria Matriz</em>.</li>
            <li>Envase/rotulagem nas <em>MCEFPs</em> com leituras IoT anexadas.</li>
            <li>Concilia√ß√£o de log√≠stica e devolu√ß√µes (cadeia fria, se aplic√°vel).</li>
            <li>Auditoria da seguran√ßa operacional e conformidade.</li>
          </ul>
        </aside>
      </div>
    </section>
  </main>

  <footer>
    ¬© BIOCERR ‚Äî BIOBlock ‚Ä¢ Infraestrutura Digital ‚Ä¢ Seguran√ßa e Transpar√™ncia por Design
  </footer>

  <script>
    (function(){
      /* Paleta */
      const c = {
        okBg:'#145a2f', okBd:'#74f2ce',         /* validado */
        pendBg:'#7b4b12', pendBd:'#ffd28f',     /* pendente */
        rejBg:'#6b1d2b', rejBd:'#ffb3c9',       /* rejeitado */
        minerBg:'#2b3a3f', minerBd:'#9fbdb6',   /* minerador */
        poolBg:'#063a6b', poolBd:'#74f2ce',     /* mempool */
        txt:'#ffffff'
      };

      /* --- N√≥s (blocos + mempool + mineradores + fork) --- */
      const nodes = new vis.DataSet([
        /* Mempool */
        { id:'mp', label:'Mempool\n(tx pendentes: 23)', shape:'box',
          color:{ background:c.poolBg, border:c.poolBd }, font:{ color:c.txt } },

        /* Cadeia principal */
        { id:'b0', label:'Bloco #0 (G√™nesis)\nprev: ‚Äî\nhash: 0000‚Ä¶1a2b', shape:'box',
          color:{ background:c.okBg, border:c.okBd }, font:{ color:c.txt } },
        { id:'b1', label:'Bloco #1 ‚Äì Produ√ß√£o Matriz\nprev: 0000‚Ä¶1a2b\nhash: 0000‚Ä¶9c3d', shape:'box',
          color:{ background:c.okBg, border:c.okBd }, font:{ color:c.txt } },
        { id:'b2', label:'Bloco #2 ‚Äì QA Matriz\nprev: 0000‚Ä¶9c3d\nhash: 0000‚Ä¶77ae', shape:'box',
          color:{ background:c.okBg, border:c.okBd }, font:{ color:c.txt } },
        { id:'b3', label:'Bloco #3 ‚Äì Envase MCEFP-07\nprev: 0000‚Ä¶77ae\nhash: 0000‚Ä¶d4f1', shape:'box',
          color:{ background:c.okBg, border:c.okBd }, font:{ color:c.txt } },
        { id:'b4', label:'Bloco #4 ‚Äì Log√≠stica\nprev: 0000‚Ä¶d4f1\nhash: 0000‚Ä¶88aa', shape:'box',
          color:{ background:c.okBg, border:c.okBd }, font:{ color:c.txt } },

        /* Pr√≥ximo bloco pendente (ainda minerando) */
        { id:'b5p', label:'Bloco #5 ‚Äì Devolu√ß√£o\nprev: 0000‚Ä¶88aa\nhash: ???', shape:'box',
          color:{ background:c.pendBg, border:c.pendBd }, font:{ color:c.txt } },

        /* Fork de exemplo (curto) */
        { id:'f3', label:'Fork: Bloco #3 º (rejeitado)\nprev: 0000‚Ä¶77ae\nhash: abcd‚Ä¶ee12', shape:'box',
          color:{ background:c.rejBg, border:c.rejBd }, font:{ color:c.txt } },

        /* Mineradores/validadores */
        { id:'m1', label:'Validador A', shape:'ellipse',
          color:{ background:c.minerBg, border:c.minerBd }, font:{ color:c.txt } },
        { id:'m2', label:'Validador B', shape:'ellipse',
          color:{ background:c.minerBg, border:c.minerBd }, font:{ color:c.txt } },
        { id:'m3', label:'Validador C', shape:'ellipse',
          color:{ background:c.minerBg, border:c.minerBd }, font:{ color:c.txt } }
      ]);

      /* --- Arestas (liga√ß√µes, refer√™ncias e trabalho de minera√ß√£o) --- */
      const edges = new vis.DataSet([
        /* Cadeia principal */
        { from:'b0', to:'b1', arrows:'to', color:{ color:'#74f2ce' } },
        { from:'b1', to:'b2', arrows:'to', color:{ color:'#74f2ce' } },
        { from:'b2', to:'b3', arrows:'to', color:{ color:'#74f2ce' } },
        { from:'b3', to:'b4', arrows:'to', color:{ color:'#74f2ce' } },
        { from:'b4', to:'b5p', arrows:'to', color:{ color:'#ffd28f' } },

        /* Mempool para pendente */
        { from:'mp', to:'b5p', dashes:true, arrows:'to', color:{ color:'#ffd28f' } },

        /* Fork curto (rejeitado) partindo de b2 */
        { from:'b2', to:'f3', arrows:'to', color:{ color:'#ff9fb3' } },

        /* Valida√ß√£o/minera√ß√£o (conceitual) */
        { from:'m1', to:'b5p', arrows:'to', dashes:true, color:{ color:'#9fbdb6' } },
        { from:'m2', to:'b5p', arrows:'to', dashes:true, color:{ color:'#9fbdb6' } },
        { from:'m3', to:'b5p', arrows:'to', dashes:true, color:{ color:'#9fbdb6' } }
      ]);

      /* --- Op√ß√µes do gr√°fico --- */
      const options = {
        physics:{
          enabled:true,
          barnesHut:{
            gravitationalConstant: -8000,
            centralGravity: 0.18,
            springLength: 220,
            springConstant: 0.045
          },
          stabilization:{ enabled:true, iterations:260 }
        },
        interaction:{ hover:true, dragNodes:true, zoomView:true, tooltipDelay: 100 },
        nodes:{ borderWidth:2, shadow:true, font:{ size:14 } },
        edges:{ arrows:{ to:{ enabled:true, scaleFactor:1.15 } }, smooth:{ enabled:true, type:'dynamic' } },
        layout:{ improvedLayout:true }
      };

      const container = document.getElementById('networkBlockchainFull');
      const network = new vis.Network(container, { nodes, edges }, options);
      window.networkBlockchainFull = network;

      /* Fit no duplo clique */
      network.on('doubleClick', () => {
        network.fit({ animation:{ duration:450, easing:'easeInOutQuad' } });
      });

      /* Texto detalhado por n√≥ */
      const meta = {
        'mp':  { t:'Mempool (Transa√ß√µes Pendentes)', d:'Conjunto de transa√ß√µes ainda n√£o inclu√≠das em bloco. Regras de fila/prioridade e taxas podem definir a ordem de inclus√£o.' },
        'b0':  { t:'Bloco G√™nesis', d:'Primeiro bloco da cadeia. Define os par√¢metros iniciais e serve de √¢ncora de confian√ßa para todo o BIOBlock.' },
        'b1':  { t:'Bloco #1 ‚Äì Produ√ß√£o (Matriz)', d:'Registra produ√ß√£o do IBC: lote, timestamp, ID, atestados de QA inicial e assinatura digital da Ind√∫stria Matriz.' },
        'b2':  { t:'Bloco #2 ‚Äì QA (Matriz)', d:'Auditorias de qualidade, amostras e calibra√ß√µes. Garante integridade do insumo b√°sico antes de envio √†s MCEFPs.' },
        'b3':  { t:'Bloco #3 ‚Äì Envase (MCEFP-07)', d:'Par√¢metros de processo, operador respons√°vel, leituras IoT (temperatura/press√£o/vaz√£o) e fotos do r√≥tulo/etiqueta.' },
        'b4':  { t:'Bloco #4 ‚Äì Log√≠stica', d:'Despacho, rastreio, cadeia fria (se aplic√°vel), checkpoints e aceite do destino. Concilia√ß√£o com transportadora.' },
        'b5p': { t:'Bloco #5 ‚Äì Devolu√ß√£o (Pendente)', d:'Dados de devolu√ß√£o/ajuste em an√°lise. Aguardando consenso dos validadores para fechar o bloco e selar o hash final.' },
        'f3':  { t:'Fork ‚Äì Bloco alternativo (Rejeitado)', d:'Ramo curto surgido ap√≥s o #2. Foi superado pela cadeia principal (#3 ‚Üí #4), portanto considerado inv√°lido pelo consenso.' },
        'm1':  { t:'Validador A', d:'Participa no consenso (verifica√ß√£o de blocos/assinaturas). Aplica regras de pol√≠tica e sanidade dos dados.' },
        'm2':  { t:'Validador B', d:'Confere integridade e ader√™ncia ao protocolo. Ajuda a rejeitar forks inconsistentes ou dados fora de pol√≠tica.' },
        'm3':  { t:'Validador C', d:'Trabalha para incluir o bloco pendente a partir do mempool, fechando o hash com prova de validade.' }
      };

      function showDetails(id){
        const d = meta[id]; if(!d) return;
        const panel = document.getElementById('details');
        panel.innerHTML = `<h4>${d.t}</h4><p>${d.d}</p><button class="close-btn" onclick="(function(p){p.style.display='none'; p.innerHTML='' })(document.getElementById('details'))">Fechar</button>`;
        panel.style.display = 'block';
        panel.scrollIntoView({ behavior:'smooth', block:'center' });
      }

      network.on('click', ev => { if(ev.nodes.length) showDetails(ev.nodes[0]); });

      /* Redesenhar ao voltar para a aba para evitar canvas "sumir" */
      document.addEventListener('visibilitychange', function(){
        if(!document.hidden && window.networkBlockchainFull) window.networkBlockchainFull.redraw();
      });

      /* Layout inicial: distribui em ‚Äúlinha‚Äù com leves varia√ß√µes para did√°tica */
      network.once('stabilized', () => {
        const pos = network.getPositions(nodes.getIds());
        const order = ['b0','b1','b2','b3','b4','b5p'];
        const baseY = 0, stepX = 180, startX = -((order.length-1)*stepX)/2;
        order.forEach((id, i) => { pos[id] = { x: startX + i*stepX, y: baseY }; });
        /* mempool e validadores ao redor */
        pos['mp'] = { x: startX + (order.length-1)*stepX + 120, y: baseY - 120 };
        pos['m1'] = { x: startX + (order.length-1)*stepX + 40,  y: baseY + 60 };
        pos['m2'] = { x: startX + (order.length-1)*stepX + 120, y: baseY + 120 };
        pos['m3'] = { x: startX + (order.length-1)*stepX + 200, y: baseY + 60 };
        /* fork abaixo do b2 */
        pos['f3'] = { x: startX + 2*stepX, y: baseY + 120 };

        network.setPositions(pos);
        network.redraw();
        network.fit({ animation:{ duration:600, easing:'easeInOutQuad' }, nodes: nodes.getIds() });
      });
    })();
  </script>
</body>
</html>
