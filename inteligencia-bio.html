<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Intelig√™ncia BIO</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --accent: #74f2ce;
      --accent-2: #2de0c1;
      --bg1: #1a1a1a;
      --bg2: #000;
    }
    body {
      margin: 0;
      padding: 40px;
      background: radial-gradient(circle at center, var(--bg1) 0%, var(--bg2) 100%);
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
    }
    .top-bar { position: absolute; top: 20px; left: 20px; z-index: 200; }
    .top-bar a {
      text-decoration: none; color: var(--accent); font-weight: bold;
      font-size: 1em; border: 1px solid var(--accent); padding: 8px 15px;
      border-radius: 20px; background: rgba(0,0,0,0.18);
    }
    h1 { text-align:center; font-size:2.4em; margin-bottom:18px;
      text-shadow: 0 0 12px var(--accent); filter: drop-shadow(0 0 5px var(--accent-2));
    }
    .content { max-width:1000px; margin:0 auto; font-size:1.05em; text-align:justify; margin-bottom:40px; }

    .layout { display:flex; justify-content:center; align-items:flex-start; gap:30px; margin-top:30px; flex-wrap:wrap; }
    .left-col { display:flex; flex-direction:column; align-items:center; flex:1 1 600px; }

    .controls { text-align:center; margin-bottom:10px; }
    .controls button {
      background: rgba(116,242,206,0.1); border:1px solid var(--accent); color:var(--accent);
      font-size:1em; margin:5px; padding:10px 20px; border-radius:25px; cursor:pointer; z-index:150;
    }

    .image-container { position:relative; text-align:center; min-height:480px; margin-top:120px; }
    .gif-wrapper {
      width:280px; height:280px; border-radius:50%; border:2px solid var(--accent);
      overflow:hidden; margin:0 auto; box-shadow:0 0 25px var(--accent-2);
      position:relative; z-index:60; background:rgba(0,0,0,0.15);
      display:flex; align-items:center; justify-content:center;
    }
    .gif-wrapper img { width:100%; height:100%; object-fit:contain; display:block; }

    .orbit { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:50; pointer-events:none; }
    .orbit-ring { position:relative; width:640px; max-width:calc(100% - 40px); height:640px; border-radius:50%; }
    .orbit-svg { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:70; }

    .module {
      position:absolute; min-width:120px; max-width:160px; height:40px;
      background: rgba(116,242,206,0.08); border-radius:20px;
      border:1px solid rgba(116,242,206,0.25);
      color:var(--accent); font-size:.95em; text-align:center; line-height:40px;
      transition: transform .18s, box-shadow .18s, background .18s, border .18s;
      pointer-events:auto; white-space:nowrap; z-index:80;
    }
    .module:hover { transform:scale(1.06); box-shadow:0 0 20px rgba(116,242,206,0.2); cursor:pointer; background:rgba(116,242,206,0.17); }
    .module.active { background: rgba(116,242,206,0.3); border:1px solid var(--accent-2); }

    .mod-resumo {
      margin-top:20px; padding:15px; max-width:500px; text-align:center; font-size:1em; color:#eee;
      border:1px solid var(--accent); border-radius:10px; background:rgba(0,0,0,0.35);
      box-shadow:0 0 12px rgba(116,242,206,0.15); opacity:1; transition:opacity .45s ease;
    }

    .panel {
      width:280px; background:rgba(0,0,0,0.55); border:1px solid var(--accent);
      border-radius:12px; padding:12px; box-shadow:0 0 12px rgba(116,242,206,0.15); font-size:.95em;
      flex-shrink:0;
    }
    .panel h2 { margin:0 0 8px 0; color:var(--accent); font-size:1em; }

    .mist { position:fixed; width:100%; height:100%; background:radial-gradient(circle, rgba(116,242,206,0.04) 0%, transparent 70%); filter:blur(25px); pointer-events:none; z-index:-1; }

    @media (max-width:900px){ .orbit-ring{width:520px;height:520px;} .gif-wrapper{width:220px;height:220px;} .module{min-width:110px;height:36px;line-height:36px;} .panel{width:220px;} }
    @media (max-width:520px){ .orbit-ring{width:360px;height:360px;} .gif-wrapper{width:160px;height:160px;} .module{min-width:90px;height:34px;line-height:34px;} .panel{width:100%;max-width:320px;} }

  </style>
</head>
<body>
  <div class="top-bar"><a href="nuvem_bio.html">‚¨ÖÔ∏è Voltar</a></div>
  <h1>Intelig√™ncia BIO</h1>

  <div class="content" id="introText">
    <!-- Texto institucional (pode manter esse bloco ou carregar do JSON se preferir) -->
    <p>
      A <strong>Intelig√™ncia BIO</strong> √© o c√©rebro sens√≠vel e distribu√≠do da arquitetura BIOCERR. Muito al√©m da automa√ß√£o, ela aprende com o territ√≥rio, escuta os saberes locais e integra dados ecol√≥gicos, sociais e econ√¥micos para orientar decis√µes regenerativas em tempo real.
    </p>

    <p>
      Atuando como interface entre comunidades, ecossistemas e tecnologias, a BIO observa padr√µes, identifica oportunidades de coopera√ß√£o e retroalimenta o sistema com conhecimento vivo. Ela promove o di√°logo entre o ancestral e o emergente, entre o digital e o org√¢nico.
    </p>

    <p>
      Conectada a sensores ambientais, plataformas de gest√£o, redes de distribui√ß√£o e bases de dados comunit√°rias, a BIO analisa fluxos, projeta cen√°rios e ajusta estrat√©gias com base em indicadores regenerativos e afetivos.
    </p>

    <p>
      Sua fun√ß√£o n√£o √© centralizar, mas distribuir intelig√™ncia. A cada n√≥ da rede, a BIO fortalece a autonomia e a sabedoria local, respeitando a singularidade de cada bioma e cultura.
    </p>

    <p>
      Na pr√°tica, ela se manifesta por meio de algoritmos transparentes, interfaces acess√≠veis, visualiza√ß√µes intuitivas e decis√µes que consideram o bem-estar coletivo e o equil√≠brio ecol√≥gico. A intelig√™ncia √© relacional, territorial e regenerativa.
    </p>
  </div>

  <div class="layout">
    <div class="left-col">
      <div class="controls">
        <button id="alertBtn">‚ö° Simular Alerta</button>
        <button id="regenBtn">üå± Regenerar Rede</button>
      </div>

      <div class="image-container" id="imageContainer">
        <div class="gif-wrapper" id="gifWrapper">
          <img src="mandala 2.gif" alt="Mandala BIO">
        </div>
        <div class="orbit">
          <div class="orbit-ring" id="orbitRing">
            <svg class="orbit-svg" id="orbitSvg"></svg>
          </div>
        </div>
      </div>

      <div class="mod-resumo" id="modResumo">üîé Selecione um m√≥dulo para ver o resumo.</div>
    </div>

    <div class="panel" aria-live="polite">
      <h2>Status BIO</h2>
      <p id="narrativa">Carregando narrativa...</p>
    </div>
  </div>

  <div class="mist"></div>

<script>
(async function(){
  // caminho pro json (mesma pasta)
  const jsonPath = "bio_data.json";
  let data = null;
  try {
    const res = await fetch(jsonPath, { cache: "no-store" });
    if (res.ok) data = await res.json();
  } catch (e) {
    console.warn("N√£o foi poss√≠vel carregar bio_data.json ‚Äî usando fallback interno.", e);
  }

  // fallback (compat√≠vel com formatos antigos e novos)
  const fallback = {
    modules: {
      "Interface":"Ponto de contato humano-digital.",
      "Seguran√ßa":"Camada de seguran√ßa e monitoramento.",
      "MCEFPs":"Mini Centrais descentralizadas.",
      "Ind√∫stria":"Ind√∫stria matriz conectada.",
      "Aprendizado":"Aprendizado regenerativo cont√≠nuo.",
      "Integra√ß√£o":"Governan√ßa e coordena√ß√£o.",
      "Log√≠stica":"Rede log√≠stica inteligente.",
      "Impacto":"Medi√ß√£o de impacto em tempo real.",
      "Sustentabilidade":"Indicadores ecol√≥gicos regenerativos.",
      "Inova√ß√£o":"Espa√ßo de inova√ß√£o aberta."
    },
    frases: [
      "‚ôªÔ∏è 98% dos dados reintegrados.",
      "üå± Sustentabilidade positiva.",
      "üöö Emiss√µes reduzidas em 12%.",
      "üîí Seguran√ßa blindada.",
      "üåç Impacto global atualizado."
    ]
  };

  const source = data || fallback;

  // Suporta ambos: "frases_gerais" ou "frases" no topo
  const frasesGerais = source.frases_gerais || source.frases || fallback.frases;

  // modules pode ser:
  // - { "Nome": "texto resumo", ... }  (formato antigo)
  // - { "Nome": { "resumo":"...", "frases":[...] }, ... } (formato novo)
  const moduleData = source.modules || fallback.modules;

  // DOM refs (mesmos do seu HTML)
  const orbitRing = document.getElementById('orbitRing');
  const orbitSvg = document.getElementById('orbitSvg');
  const gifWrapper = document.getElementById('gifWrapper');
  const resumoEl = document.getElementById('modResumo');
  const narrEl = document.getElementById('narrativa');

  const moduleNames = Object.keys(moduleData);
  let modules = [], lines = [];
  let angleOffset = 0;
  const speed = 0.12;

  // controle de ciclos de frases
  let generalInterval = null;
  let moduleInterval = null;
  let selectedModule = null;
  let generalIndex = 0;

  function clearPhraseIntervals(){
    if(moduleInterval){ clearInterval(moduleInterval); moduleInterval = null; }
    if(generalInterval){ clearInterval(generalInterval); generalInterval = null; }
  }

  function startGeneralCycle(){
    clearPhraseIntervals();
    if(!frasesGerais || frasesGerais.length === 0){
      narrEl.textContent = "";
      return;
    }
    generalIndex = 0;
    narrEl.textContent = frasesGerais[generalIndex];
    generalInterval = setInterval(()=>{
      generalIndex = (generalIndex + 1) % frasesGerais.length;
      // s√≥ continuar geral se nenhum m√≥dulo estiver selecionado
      if(!selectedModule) narrEl.textContent = frasesGerais[generalIndex];
      else { clearInterval(generalInterval); generalInterval = null; }
    }, 5000);
  }

  function showModulePhrases(name){
    clearPhraseIntervals();
    selectedModule = name;
    const entry = moduleData[name];
    // if entry is object with "frases" array
    if(entry && typeof entry === 'object' && Array.isArray(entry.frases) && entry.frases.length > 0){
      let i = 0;
      narrEl.textContent = entry.frases[i];
      moduleInterval = setInterval(()=>{
        i = (i + 1) % entry.frases.length;
        // se o m√≥dulo foi desmarcado, parar
        if(selectedModule !== name){ clearInterval(moduleInterval); moduleInterval = null; return; }
        narrEl.textContent = entry.frases[i];
      }, 4200);
      return;
    }

    // if entry is object but no frases -> show resumo or fallback
    if(entry && typeof entry === 'object'){
      narrEl.textContent = entry.resumo || Object.values(entry).join(" ");
      return;
    }

    // if entry is string -> show it
    if(typeof entry === 'string'){
      narrEl.textContent = entry;
      return;
    }

    narrEl.textContent = "‚Äî";
  }

  function createStructure(){
    orbitRing.querySelectorAll('.module').forEach(n=>n.remove());
    orbitSvg.innerHTML = '';
    modules = []; lines = [];

    moduleNames.forEach((name)=>{
      const el = document.createElement('div');
      el.className = 'module';
      el.textContent = name;
      orbitRing.appendChild(el);
      modules.push(el);

      const line = document.createElementNS("http://www.w3.org/2000/svg","line");
      line.setAttribute('stroke','rgba(116,242,206,0.18)');
      line.setAttribute('stroke-width','2');
      orbitSvg.appendChild(line);
      lines.push(line);

      // tooltip = resumo se existir
      const entry = moduleData[name];
      if(entry && typeof entry === 'object' && entry.resumo) el.title = entry.resumo;
      else if(typeof entry === 'string') el.title = entry;

      // clique mostra resumo do formato novo/antigo e ativa frases do m√≥dulo
      el.addEventListener('click', ()=>{
        modules.forEach(m=>m.classList.remove('active'));
        el.classList.add('active');

        // fade-out then update then fade-in
        resumoEl.style.opacity = 0;
        // determine resumo text:
        setTimeout(()=>{
          const entry = moduleData[name];
          let txt = "";
          if(entry && typeof entry === 'object') txt = entry.resumo || JSON.stringify(entry);
          else if(typeof entry === 'string') txt = entry;
          else txt = "Resumo n√£o encontrado para " + name;
          resumoEl.textContent = "üìå " + txt;
          resumoEl.style.opacity = 1;
        }, 260);

        // mostrar frases do m√≥dulo
        showModulePhrases(name);

        // auto-desselect after 6s -> resume general phrases
        if(selectedModule) {
          // cancel previous timeout by using a new timer variable? simple approach:
          setTimeout(()=>{
            // only clear selection if still this module
            if(selectedModule === name){
              selectedModule = null;
              modules.forEach(m=>m.classList.remove('active'));
              clearPhraseIntervals();
              startGeneralCycle();
            }
          }, 6000);
        }
      }, {passive:true});
    });
  }

  function update(){
    if(modules.length===0){ requestAnimationFrame(update); return; }
    const ringRect = orbitRing.getBoundingClientRect();
    const gifRect = gifWrapper.getBoundingClientRect();
    const ringW = ringRect.width, ringH = ringRect.height;
    const centerX = (gifRect.left - ringRect.left) + gifRect.width/2;
    const centerY = (gifRect.top - ringRect.top) + gifRect.height/2;

    const modW = modules[0].offsetWidth;
    const modH = modules[0].offsetHeight;

    const maxRad = Math.min(ringW, ringH)/2 - Math.max(modW, modH)/2 - 18;
    const minRad = gifRect.width/2 + Math.max(modW, modH)/2 + 20;
    const radius = Math.max(minRad, Math.min(maxRad, 200));

    orbitSvg.setAttribute('viewBox', `0 0 ${ringW} ${ringH}`);

    modules.forEach((m,i)=>{
      const baseAngle = (360/modules.length)*i;
      const angle = baseAngle + angleOffset;
      const rad = (angle-90)*Math.PI/180;
      const x = centerX + radius*Math.cos(rad) - modW/2;
      const y = centerY + radius*Math.sin(rad) - modH/2;
      m.style.left = x + "px";
      m.style.top = y + "px";
      lines[i].setAttribute('x1', centerX);
      lines[i].setAttribute('y1', centerY);
      lines[i].setAttribute('x2', x+modW/2);
      lines[i].setAttribute('y2', y+modH/2);
    });

    angleOffset += speed;
    requestAnimationFrame(update);
  }

  // bot√µes
  document.getElementById('alertBtn').onclick = ()=>{
    modules.forEach(m=>m.style.background="rgba(255,75,75,0.28)");
    lines.forEach(l=>l.setAttribute('stroke','rgba(255,75,75,0.6)'));
    // mensagem tempor√°ria na narrativa
    clearPhraseIntervals();
    narrEl.textContent = "‚ö° Alerta: verificando fluxos cr√≠ticos...";
    setTimeout(()=>{
      modules.forEach(m=>m.style.background="");
      lines.forEach(l=>l.setAttribute('stroke','rgba(116,242,206,0.18)'));
      if(!selectedModule) startGeneralCycle();
    },2000);
  };

  document.getElementById('regenBtn').onclick = ()=>{
    let step=0;
    clearPhraseIntervals();
    narrEl.textContent = "üå± Regenerando rede...";
    const interval = setInterval(()=>{
      if(step<modules.length){
        modules[step].style.background="rgba(75,255,119,0.28)";
        lines[step].setAttribute('stroke','rgba(75,255,119,0.7)');
        step++;
      } else {
        clearInterval(interval);
        setTimeout(()=>{
          modules.forEach(m=>m.classList.remove('active'));
          modules.forEach(m=>m.style.background="");
          lines.forEach(l=>l.setAttribute('stroke','rgba(116,242,206,0.18)'));
          if(!selectedModule) startGeneralCycle();
        },1000);
      }
    },200);
  };

  // inicializa
  createStructure();
  requestAnimationFrame(update);
  startGeneralCycle();

})();
</script>

</body>
</html>
